

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; MAMMOTH  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]]}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Prepare Data" href="prepare_data.html" />
    <link rel="prev" title="Attention Bridge" href="attention_bridges.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MAMMOTH
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="main.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">About MAMMOTH</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html#mammoth-and-opennmt">MAMMOTH and OpenNMT</a></li>
</ul>
<p class="caption"><span class="caption-text">MAMMOTH features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modular_model.html">Modular Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_config.html">Config-config tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="attention_bridges.html">Attention Bridge</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#puhti-mahti">Puhti / Mahti</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run">Run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lumi">LUMI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prepare_data.html">Prepare Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/train_mammoth_101.html">Train your MAMMOTH model 101</a></li>
</ul>
<p class="caption"><span class="caption-text">Scripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="options/build_vocab.html">Build Vocab</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/train.html">Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/translate.html">Translate</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/server.html">Server</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mammoth.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="mammoth.modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="mammoth.translation.html">Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mammoth.translate.translation_server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="mammoth.inputters.html">Data Loaders</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAMMOTH</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/install.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>Installing from source usually works. Here, we provide two examples that install MAMMOTH in Nvidia and AMD platforms.</p>
<div class="section" id="puhti-mahti">
<h2>Puhti / Mahti<a class="headerlink" href="#puhti-mahti" title="Permalink to this headline">¶</a></h2>
<p>This first example install MAMMOTH on clusters (<a class="reference external" href="https://docs.csc.fi/computing/">Puhti/Mahti</a>) with Nvidia GPUs.</p>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<p>In the login node, create a directory in the <code class="docutils literal notranslate"><span class="pre">projappl</span></code> linked to our project to host the shared python dependencies, and install the code base &amp; dependencies there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># where to install the necessary python packages
PROJECT=&lt;your_project_name_is_your_account&gt;
ENV_DIR=&quot;/projappl/${PROJECT}/test&quot;
# where the codebase was copied to
CODE_DIR=&quot;/scratch/${PROJECT}/path/to/mammoth&quot;

# set up variables &amp; modules
module load pytorch
mkdir -p $ENV_DIR
export PYTHONUSERBASE=$ENV_DIR

#install dependencies
cd $CODE_DIR
pip3 install -e . --user

# optionally, to make sure that other people can access this install:
chmod -R 777 $ENV_DIR
chmod -R 777 $CODE_DIR
</pre></div>
</div>
</div>
<div class="section" id="run">
<h3>Run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h3>
<p>In slurm job scripts, update environment variables to get python to run your code properly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ENV_DIR=&quot;/projappl/${PROJECT}/test&quot;
CODE_DIR=&quot;/scratch/${PROJECT}/path/to/mammoth&quot;

module load pytorch
export PYTHONUSERBASE=$ENV_DIR
# note: this overwrites the path, you can also try appending this subdirectory instead
export PYTHONPATH=$ENV_DIR/lib/python3.9/site-packages/

srun python3 -u $CODE_DIR/train.py ...
</pre></div>
</div>
</div>
</div>
<div class="section" id="lumi">
<h2>LUMI<a class="headerlink" href="#lumi" title="Permalink to this headline">¶</a></h2>
<p>The GPU partition of <a class="reference external" href="https://lumi-supercomputer.github.io">LUMI supercomputer</a> is AMD-based.
This example uses python virtual environment without container. But as recommended by the LUST team of LUMI, better to use container. An instruction to install MAMMOTH under Singularity container will release in the future.</p>
<!-- TODO --><div class="section" id="id1">
<h3>Install<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Start an interactive session <code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--account=&quot;$PROJECT&quot;</span> <span class="pre">--partition=dev-g</span> <span class="pre">--ntasks=1</span> <span class="pre">--gres=gpu:mi250:1</span> <span class="pre">--time=2:00:00</span> <span class="pre">--mem=25G</span> <span class="pre">--pty</span> <span class="pre">bash</span></code></p></li>
<li><p>Load modules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>load<span class="w"> </span>cray-python
module<span class="w"> </span>load<span class="w"> </span>LUMI/22.08<span class="w"> </span>partition/G<span class="w"> </span>rocm/5.2.3

module<span class="w"> </span>use<span class="w"> </span>/pfs/lustrep2/projappl/project_462000125/samantao-public/mymodules
module<span class="w"> </span>load<span class="w"> </span>aws-ofi-rccl/rocm-5.2.3
</pre></div>
</div>
</li>
<li><p>Create virtual environment <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">your_vevn_name</span></code> and activate it <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">your_venv_name/bin/activate</span></code>.</p></li>
<li><p>Install pytorch: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">torch==1.13.1+rocm5.2</span> <span class="pre">--extra-index-url</span> <span class="pre">https://download.pytorch.org/whl/rocm5.2</span></code></p></li>
<li><p>Install mammoth</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/pfs/lustrep1/projappl/<span class="si">${</span><span class="nv">PROJECT</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/mammoth
pip3<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
pip3<span class="w"> </span>install<span class="w"> </span><span class="nv">sentencepiece</span><span class="o">==</span><span class="m">0</span>.1.97<span class="w"> </span><span class="nv">sacrebleu</span><span class="o">==</span><span class="m">2</span>.3.1
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id2">
<h3>Run<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>You can train in slurm job scripts, such as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span>python<span class="w"> </span>-u<span class="w"> </span><span class="nv">$CODE_DIR</span>/train.py<span class="w"> </span>...
</pre></div>
</div>
<p>For more details, we refer to the tutorial section.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="prepare_data.html" class="btn btn-neutral float-right" title="Prepare Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="attention_bridges.html" class="btn btn-neutral float-left" title="Attention Bridge" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, HelsinkiNLP

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>